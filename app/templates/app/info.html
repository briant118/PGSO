<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PGSO Resident Scanner</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1e3a5f 0%, #152a45 100%);
      min-height: 100vh;
      color: #fff;
      padding: 1.5rem;
    }
    .card {
      background: rgba(255,255,255,0.1);
      border-radius: 16px;
      padding: 2rem;
      max-width: 420px;
      margin: 0 auto;
      text-align: center;
    }
    h1 { font-size: 1.25rem; margin-bottom: 1rem; }
    p { opacity: 0.9; line-height: 1.6; margin-bottom: 1rem; }
    .hint { font-size: 0.9rem; opacity: 0.8; }
    .profile { display: none; text-align: left; }
    .profile.visible { display: block; }
    .profile-row { padding: 0.5rem 0; border-bottom: 1px solid rgba(255,255,255,0.2); }
    .btn { display: inline-block; padding: 0.75rem 1.5rem; background: #17a2b8; color: #fff; border-radius: 8px; text-decoration: none; margin-top: 1rem; font-weight: 600; }
  </style>
</head>
<body>
  <div class="card" id="infoCard">
    <h1>PGSO Resident Scanner</h1>
    <p>Use the <strong>PGSO Resident Scanner</strong> Expo app on your phone to scan resident QR codes.</p>
    <p class="hint">From <code>pgso-app</code> folder: <code>npx expo start</code></p>
  </div>
  <div class="card profile" id="profileCard">
    <h1 id="profileName">-</h1>
    <p id="profileId">-</p>
    <div id="profileBody"></div>
    <a href="#" id="btnDownload" class="btn">Download PDF</a>
  </div>
  <script>
    var params = new URLSearchParams(location.search);
    var resId = params.get('res');
    if (resId) {
      document.getElementById('infoCard').style.display = 'none';
      document.getElementById('profileCard').classList.add('visible');
      fetch('/app/api/resident/' + resId + '/')
        .then(function(r) { return r.json(); })
        .then(function(d) {
          document.getElementById('profileName').textContent = d.full_name || '-';
          document.getElementById('profileId').textContent = 'ID: ' + (d.resident_id || d.id);
          var rows = [['Contact', d.contact_no], ['Gender', d.gender], ['Status', d.status], ['DOB', d.date_of_birth], ['Age', d.age + ' yrs'], ['Address', d.address], ['Barangay', d.barangay]];
          document.getElementById('profileBody').innerHTML = rows.map(function(r) {
            return '<div class="profile-row"><strong>' + r[0] + ':</strong> ' + (r[1] || 'â€”') + '</div>';
          }).join('');
          document.getElementById('btnDownload').href = d.pdf_url;
        });
    }
  </script>
</body>
</html>
